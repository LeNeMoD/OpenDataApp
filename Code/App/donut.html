<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

        <!-- d3 library -->
        <script src="https://d3js.org/d3.v4.min.js"></script>

        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

        <link rel="stylesheet" type="text/css" href="APPCSS.css">

        <style>
            .pie {
                margin: 20px;
            }

            .pie text {
                font-family: "Verdana";
                fill: #888;
            }

            .pie .name-text{
                font-size: 1em;
            }

            .pie .value-text{
                font-size: 3em;
            }
        </style>

    </head>
    <body>


        <div id="donutChart"></div>

        <script>

            var nestedData;
            d3.json("DatenWasserBereinigt_V2.json", function(error, data) {
                if (error) throw error;
                //console.log(data);
                // Helper Function Nest Data
                nestData(data);
                function nestData(data){
                    var nested = d3.nest()
                    .key(function(d) {return d["Zuordnung"];})
                    .entries(data);
                    nestedData = nested;
                    console.log(nestedData);
                    return nested;

                }
                
                
                function test(){
                    for(key in nestedData){
                        console.log("testlog");
                        console.log(nestedData[key].values[1].WertText);
                        for(i=0; i< nestedData[key].values.length; i++){
                             //console.log(nestedData[key].values[i].WertText);

                        }
                    }
                }
                test();

                var text = "";

                var width = 260;
                var height = 260;
                var thickness = 40;
                var duration = 750;

                var radius = Math.min(width, height) / 2;
                var color = d3.scaleOrdinal(d3.schemeCategory10);

                var svg = d3.select("#donutChart")
                .append('svg')
                .attr('class', 'pie')
                .attr('width', width)
                .attr('height', height);

                var g = svg.append('g')
                .attr('transform', 'translate(' + (width/2) + ',' + (height/2) + ')');

                var arc = d3.arc()
                .innerRadius(radius - thickness)
                .outerRadius(radius);



                var pie = d3.pie()
                .value(function(d) {console.log(d.key);
                                    return d.values.WertText; })
                .sort(null);

                var path = g.selectAll('path')
                .data(pie(nestedData))
                .enter()
                .append("g")
                .on("mouseover", function(d) {
                    let g = d3.select(this)
                    .style("cursor", "pointer")
                    .style("fill", "black")
                    .append("g")
                    .attr("class", "text-group");

                    g.append("text")
                        .attr("class", "name-text")
                        .text(`${d.key}`)
                        .attr('text-anchor', 'middle')
                        .attr('dy', '-1.2em');

                    /*g.append("text")
                        .attr("class", "value-text")
                        .text(`${d.data.value}`)
                        .attr('text-anchor', 'middle')
                        .attr('dy', '.6em');*/
                })
                .on("mouseout", function(d) {
                    d3.select(this)
                        .style("cursor", "none")  
                        .style("fill", color(this._current))
                        .select(".text-group").remove();
                })
                .append('path')
                .attr('d', arc)
                .attr('fill', (d,i) => color(i))
                .on("mouseover", function(d) {
                    d3.select(this)     
                        .style("cursor", "pointer")
                        .style("fill", "black");
                })
                .on("mouseout", function(d) {
                    d3.select(this)
                        .style("cursor", "none")  
                        .style("fill", color(this._current));
                })
                .each(function(d, i) { this._current = i; });


                g.append('text')
                    .attr('text-anchor', 'middle')
                    .attr('dy', '.35em')
                    .text(text);
            });

        </script>
    </body>
</html>