<!DOCTYPE html>
<html>
    <head>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <!-- JQuery --> 
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <!-- Popper -->         
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
        <!-- latest Bootstrapâ€™s compiled CSS and JS --> 
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
        <link rel="stylesheet" type="text/css" href="externalCss2.css">

    </head>
    <body>
        <div class="container-fluid">
        <div class="row">
        <div id="wrapper">
            <div class="col-sm-12 col-lg-3">
            <nav class="navbar navbar-default" role="navigation">
                <div class="container">
                    <div id="sidebar-wrapper" class="sidebar-toggle">
                        <ul class="sidebar-nav" id="sidebar">
                        </ul>
                    </div>
                </div>
            </nav>
            </div>

            <div class="col-sm-12 col-lg-9">
            <div id="page-content-wrapper">
                <div class="content-header">
                </div>
                <!-- Keep all page content within the page-content inset div! -->
                <div class="page-content inset">
                        <svg  height="500"></svg>
                </div>
            </div>
        </div>
            </div>
            </div>                                          
        </div>
        <!--<svg width="960" height="500">-->
        
        <script>

            d3.json("2013-Cut-Pestizide-Atrazin-JSON.json", function(error, data) {
                if (error) throw error;

                //--------START---------Parse Date--------------//
                var parseTime = d3.timeParse("%d.%m.%Y");

                data.forEach(function(d) {
                    d.Datum_Start = parseTime(d.Datum_Start);
                    //console.log(d.Datum_Start);
                    d.M_in_mg_L = +d.M_in_mg_L;
                    //console.log(d.M_in_mg_L);
                });
                //--------END---------Parse Date--------------//


                //--------START---------Nest Data--------------//
                function nestParams(data){
                    var nested = d3.nest()
                    .key(function(d) {return d["Parameter"];})
                    .entries(data);
                    //d3.select("body").append("pre")
                    //    .text(JSON.stringify(nested, null, 2));
                    return nested;
                }
                //console.log("nestParams is logged: ");
                //console.log(nestParams(data));

                var nestedDataParamTypes = nestParams(data);
                //console.log("nestedDataParams Variable is logged: ");
                //console.log(nestedDataParamTypes);
                //--------END---------Nest Data--------------//

                //--------Start---------Visual HTML Elements--------------//
                var svg = d3.select("svg");
                var margin = {top: 20, right: 20, bottom: 30, left: 400};
                //var width = +svg.attr("width") - margin.left - margin.right;
                var height = +svg.attr("height") - margin.top - margin.bottom;
                //var g = svg.append("g")
                   // .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                //--------Start---------Graph things--------------//
                
                var xScale = d3.scaleTime();//.rangeRound([0, width]);
                var yScale = d3.scaleLinear().rangeRound([height, 0]);
                var zScale = d3.scaleOrdinal(d3.schemeCategory10);
                
                var xAxis = d3.axisBottom().scale(xScale);
                var yAxis = d3.axisLeft().scale(yScale);
                
                var line = d3.line();
                    //.curve(d3.curveBasis);
                    //.x(function(d) { return x(d.Datum_Start); })
                    //.y(function(d) { return y(d.M_in_mg_L); });
                
                xScale.domain(d3.extent(data, function(d) { return d.Datum_Start; }));
                yScale.domain(d3.extent(data, function(d) { return d.M_in_mg_L; }));
                
                
                var artboard = svg.append("g")
                        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
                
                var yAxisEl = artboard.append("g")
                        .call(yAxis);
                
                var xAxisEl = artboard.append("g")
                        .attr("transform", "translate(0," + height + ")");
                
                // draw the line created above
                var path = artboard.append("path").data([data])
                    .style('fill', 'none')
                    .style('stroke', 'steelblue')
                    .style('stroke-width', '2px');
                
                    
                artboard.append("g")
                    .call(yAxis)
                    .append("text")
                    .attr("fill", "#000")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", "0.71em")
                    .attr("text-anchor", "middle")
                    .text("MG/L");
                
                
                
                
                
                function drawChart() {
                    // reset the width
                        width = parseInt(d3.select('body').style('width'), 10) - margin.left - margin.right;
    
                    // set the svg dimensions
                        svg.attr("width", width + margin.left + margin.right);
    
                    // Set new range for xScale
                        xScale.range([0, width]);
    
                    // give the x axis the resized scale
                        xAxis.scale(xScale);
    
                    // draw the new xAxis
                        xAxisEl.call(xAxis);
    
                    // specify new properties for the line
                        line.x(function(d) { return xScale(d.Datum_Start); })
                            .y(function(d) { return yScale(d.M_in_mg_L); });
                    
                    // draw the path based on the line created above
                    //path.datum(data)
                      //  .attr("fill", "none")
                    //    .attr("stroke", "steelblue")
                    //    .attr("stroke-linejoin", "round")
                    //    .attr("stroke-linecap", "round")
                    //    .attr("stroke-width", 1.5)
                    //    .attr("d", line);
                   
                    artboard.selectAll("circle")
                    .data(data)
                    .enter()
                        .append("circle")
                        .attr("r", 2.5)
                        .style("fill","blue")
                        .attr("cx", function(d) { return xScale(d.Datum_Start); })
                        .attr("cy", function(d) { return yScale(d.M_in_mg_L); })
                        .on("mouseover", handleMouseEnter)
                        .on("mouseout", handleMouseLeave);

                }
                
                drawChart();
                
                
                /*g.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x))
                    .select(".domain")
                    .remove();
                    
                g.append("g")
                    .call(d3.axisLeft(y))
                    .append("text")
                    .attr("fill", "#000")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", "0.71em")
                    .attr("text-anchor", "middle")
                    .text("MG/L");

                g.append("path")
                    .datum(data)
                    .attr("fill", "none")
                    .attr("stroke", "steelblue")
                    .attr("stroke-linejoin", "round")
                    .attr("stroke-linecap", "round")
                    .attr("stroke-width", 1.5)
                    .attr("d", line);
                
                g.selectAll("circle")
                    .data(data)
                    .enter()
                        .append("circle")
                        .attr("r", 1.5)
                        .attr("cx", function(d) { return x(d.Datum_Start); })
                        .attr("cy", function(d) { return y(d.M_in_mg_L); })
                        .on("mouseover", handleMouseEnter)
                        .on("mouseout", handleMouseLeave);
                */
                //--------END---------Graph things--------------//
                //--------START-------Other Elements------------
                //var circleGroup = svg.select("g").append("g")
                //    .attr('id', 'circleGroup');
                
                var existingParameters = [];
                for(i=0; i<data.length; i++){
                    existingParameters.indexOf(data[i].Parameter) === -1 ? existingParameters.push(data[i].Parameter) : null ;
                    existingParameters.sort();
                }  
                //console.log(existingParameters);

                /*var ul = d3.select('#sidebar')
                    .selectAll('option')
                    .data(existingParameters)
                    .enter()
                    .append('option')
                    .html(String);*/

                var ul = d3.select('#sidebar')
                .selectAll("li")
                .data(existingParameters)
                .enter()
                .append("li")
                .append("button")
                .attr("type", "button")
                .attr("class", "btn btn-outline-primary btn-block")

                //.attr("href", String)  --- only if linked to some site .. ! internal ? 
                .html(String)
                .style("color", "white");
                
                //--------START-------Event Handlers------------//
                
                function handleMouseEnter(d, i) {
                    d3.select(this)
                        .attr("opacity", 1.0)
                        .attr("r", 10)
                        .attr("stroke", "black")
                        .style("fill","yellow");
                    //d3.select(this).style("fill","green");
                    }
                
                function handleMouseLeave(d, i) {
                    d3.select(this)
                        .attr("opacity" , 1.0)
                        .attr("r", 2.5)
                        .style("fill","blue");
                }
                
                window.addEventListener('resize', drawChart);
                window.addEventListener('resize',  function() {
                        console.log("The window was resized!");
                        });                
                //--------END---------Event Handlers------------//
            }); 

        </script>

    </body>

</html>
